---
import { getCollection } from 'astro:content';
import type { Item } from '~/types';
import Hero2 from '~/components/widgets/Hero2.astro';
import WidgetWrapper from '~/components/ui/WidgetWrapper.astro';
import Headline from '~/components/ui/Headline.astro';
import ItemGrid from '~/components/ui/ItemGrid.astro';
import FAQs from '~/components/widgets/FAQs.astro';
import PageCarousel from '~/components/widgets/PageCarousel.astro';
import { getLangFromUrl, useTranslations } from '~/i18n/utils';

const language = getLangFromUrl(Astro.url);
const t = useTranslations(language);

import buoyImage from '~/assets/images/boje.jpg';


const faqEntries = await getCollection('faq');
const faqs = faqEntries
  .filter((entry) => entry.data.area === 'buoy')
  .sort((a, b) => (a.data.order ?? 999) - (b.data.order ?? 999))
  .map((entry) => {
    const d = entry.data;
    const lang = language as 'en' | 'de';
    return {
      title: (d.question && (d.question[lang] ?? d.question.en)) ?? '',
      description: (d.answer && (d.answer[lang] ?? d.answer.en)) ?? '',
    };
  });

const pageCarouselEntries = await getCollection('pageCarousel');
const carouselItems = pageCarouselEntries
  .filter((entry) => entry.data.area === 'buoy')
  .sort((a, b) => (a.data.order ?? 999) - (b.data.order ?? 999))
  .map((entry) => {
    const d = entry.data;
    const lang = language as 'en' | 'de';
    const localizedTitle = (d.title && (d.title[lang] ?? d.title.en)) ?? '';
    return {
      image: d.image,
      imageAlt: (d.imageAlt && (d.imageAlt[lang] ?? d.imageAlt.en)) ?? localizedTitle,
      title: localizedTitle,
      description: (d.description && (d.description[lang] ?? d.description.en)) ?? '',
    };
  });

export interface Props {
  techItems: Item[];
  downloadItems: Array<{ title: string; description?: string; href: string; ctaText: string }>;
}

const {
  techItems,
  downloadItems,
} = Astro.props;

const downloadGridItems: Item[] = downloadItems.map((d) => ({
  title: d.title,
  description: d.description,
  icon: 'tabler:file-type-pdf',
  callToAction: {
    href: d.href,
    text: d.ctaText,
    target: '_blank',
    rel: 'noopener noreferrer',
  },
}));
---

<Hero2
  image={{
    src: buoyImage,
    alt: 'SmartBuoy buoy on the water',
  }}
>
  <Fragment slot="title">
    <span class="text-primary dark:text-white highlight">{t('buoy.hero.title')}</span>
    
  </Fragment>

  <Fragment slot="subtitle">{t('buoy.hero.subtitle')}</Fragment>
</Hero2>

{carouselItems.length > 0 && (
  <PageCarousel
    id="buoy-carousel"
    title={t('buoy.carousel.title')}
    subtitle={t('buoy.carousel.subtitle')}
    tagline={t('buoy.carousel.tagline')}
    items={carouselItems}
  />
)}

<WidgetWrapper id="technical-details" containerClass="max-w-5xl">
  <Headline
    title={t('buoy.tech.title')}
    subtitle={t('buoy.tech.subtitle')}
    classes={{
      container: 'max-w-3xl mx-auto',
      title: 'text-3xl md:text-4xl font-bold tracking-tighter mb-4 font-heading',
      subtitle: 'text-xl text-muted',
    }}
  />
  <ItemGrid
    items={techItems}
    columns={2}
    defaultIcon="tabler:anchor"
    classes={{
      container: 'gap-y-8 md:gap-y-10',
      panel: 'max-w-none',
      title: 'text-lg font-bold dark:text-white',
      description: 'text-muted dark:text-slate-400',
      icon: 'text-primary flex-shrink-0',
    }}
  />
</WidgetWrapper>

<WidgetWrapper id="downloads" containerClass="max-w-5xl">
  <Headline
    title={t('buoy.download.title')}
    subtitle={t('buoy.download.subtitle')}
    classes={{
      container: 'max-w-3xl mx-auto',
      title: 'text-3xl md:text-4xl font-bold tracking-tighter mb-4 font-heading',
      subtitle: 'text-xl text-muted',
    }}
  />
  <ItemGrid
    items={downloadGridItems}
    columns={2}
    defaultIcon="tabler:file-type-pdf"
    classes={{
      container: 'gap-y-8 md:gap-y-10',
      panel: 'max-w-none',
      title: 'text-lg font-bold dark:text-white',
      description: 'text-muted dark:text-slate-400',
      icon: 'text-primary flex-shrink-0',
      action: 'mt-2',
    }}
  />
</WidgetWrapper>

{faqs.length > 0 && (
  <FAQs
    title={t('buoy.faq.title')}
    subtitle={t('buoy.faq.sub-title')}
    tagline={t('buoy.faq.tagline')}
    items={faqs}
  />
)}
