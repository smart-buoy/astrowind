---
import { getCollection } from 'astro:content';
import { getLangFromUrl, useTranslations } from '~/i18n/utils';
import Hero2 from '~/components/widgets/Hero2.astro';
import WidgetWrapper from '~/components/ui/WidgetWrapper.astro';
import AboutTimeline from '~/components/widgets/AboutTimeline.astro';
import Features from '~/components/widgets/Features.astro';
import { formatFrontmatterRichText, formatTranslationRichText } from '~/i18n/richText';
import Headline from '~/components/ui/Headline.astro';

const language = getLangFromUrl(Astro.url);
const t = useTranslations(language);

import aboutImage from '~/assets/images/ueberuns.jpg';

const trInline = (key: string) => formatTranslationRichText(t(key) as string);
const trBlock = (key: string) => formatFrontmatterRichText(t(key) as string);
const bullets = (t('about.story.bullets') as string).split('|').map((item) => item.trim());
const paragraphClass = 'text-lg leading-relaxed text-muted dark:text-slate-300';
const aboutHeadlineTitleClass = 'text-2xl sm:text-3xl tracking-tight dark:text-white';
const aboutValues = (await getCollection('aboutValues'))
  .sort((a, b) => a.data.order - b.data.order)
  .map((entry) => ({
    title: entry.data.title[language] ?? entry.data.title.en ?? '',
    description: entry.data.description[language] ?? entry.data.description.en ?? '',
    icon: entry.data.icon ?? 'tabler:circle-check',
  }));
---

<Hero2
  tagline={t('about.hero.tagline')}
  image={{
    src: aboutImage,
    alt: 'SmartBuoy team on the water',
  }}
>
  <Fragment slot="title">
    <span class="text-primary dark:text-white highlight">{t('about.hero.title')}</span> <br />
    {t('about.hero.subtitle')}
  </Fragment>

  <Fragment slot="subtitle"></Fragment>
</Hero2>

<WidgetWrapper id="intro" containerClass="max-w-5xl">
  <div class="max-w-none text-left">
    <div class={paragraphClass} set:html={trBlock('about.intro.paragraph1')}></div>
    <Headline
      title={trInline('about.intro.subheadline')}
      classes={{
        container: 'mt-6 mb-6 md:mb-6 text-left md:mx-0 max-w-none',
        title: `${aboutHeadlineTitleClass} text-primary dark:text-primary`,
      }}
    />
  </div>
</WidgetWrapper>

<WidgetWrapper id="story" containerClass="max-w-5xl">
  <div class="max-w-none text-left">
    <Headline
      title={trInline('about.story.title')}
      classes={{
        container: 'mb-6 md:mb-6 text-left md:mx-0 max-w-none',
        title: aboutHeadlineTitleClass,
      }}
    />
    <div class={paragraphClass} set:html={trBlock('about.story.paragraph1')}></div>
    <div class={paragraphClass} set:html={trBlock('about.story.paragraph2')}></div>
    <ul class={`list-disc pl-6 space-y-2 my-6 ${paragraphClass}`}>
      {bullets.map((item) => (
        <li>
          <span set:html={formatTranslationRichText(item)}></span>
        </li>
      ))}
    </ul>
    <div class={paragraphClass} set:html={trBlock('about.story.conclusion')}></div>
  </div>
</WidgetWrapper>

<AboutTimeline />

{
  aboutValues.length > 0 && (
    <Features
      id="about-values"
      tagline={t('about.values.tagline')}
      title={t('about.values.title')}
      subtitle={t('about.values.subtitle')}
      items={aboutValues}
    />
  )
}
